{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { routeConstants } from \"../constants\";\nexport default class AuthService {\n  constructor() {\n    this.fetch = this.fetch.bind(this);\n    this.login = this.login.bind(this);\n    this.getProfile = this.getProfile.bind(this);\n  }\n\n  async login(email, password) {\n    // Get a token\n    const response = this.fetch(routeConstants.ADMIN_LOGIN, {\n      method: 'POST',\n      body: JSON.stringify({\n        email,\n        password\n      })\n    });\n\n    if (response.success) {\n      this.setProfile(res);\n    } else {}\n\n    return Promise.resolve(response);\n  }\n\n  loginAdmin(email, password) {\n    // Get a token\n    return this.fetch(`${this.domain}/api/token`, {\n      method: 'POST',\n      body: JSON.stringify({\n        email,\n        password\n      })\n    }).then(res => {\n      this.setToken(res);\n      return this.fetch(`${this.domain}/api/user`, {\n        method: 'GET'\n      });\n    }).then(res => {\n      this.setProfile(res);\n      return Promise.resolve(res);\n    });\n  }\n\n  loggedIn() {\n    // Checks if there is a saved token and it's still valid\n    const token = this.getToken(); // return !!token && !isTokenExpired(token) // handwaiving here\n\n    return !!token; // handwaiving here\n  }\n\n  setProfile(profile) {\n    // Saves profile data to localStorage\n    localStorage.setItem('profile', JSON.stringify(profile));\n  }\n\n  getProfile() {\n    // Retrieves the profile data from localStorage\n    const profile = localStorage.getItem('profile');\n    return profile ? JSON.parse(localStorage.profile) : {};\n  }\n\n  setToken(tokenResponse) {\n    // Saves user token to localStorage\n    localStorage.setItem('id_token', tokenResponse.accessToken);\n    localStorage.setItem('token', tokenResponse.token);\n  }\n\n  getToken() {\n    // Retrieves the user token from localStorage\n    return localStorage.getItem('id_token');\n  }\n\n  logout() {\n    // Clear user token and profile data from localStorage\n    localStorage.removeItem('id_token');\n    localStorage.removeItem('profile');\n  }\n\n  _checkStatus(response) {\n    // raises an error in case response status is not a success\n    if (response.status >= 200 && response.status < 300) {\n      return response;\n    } else {\n      var error = new Error(response.statusText);\n      error.response = response;\n      throw error;\n    }\n  }\n\n  fetch(url, options) {\n    // performs api calls sending the required authentication headers\n    const headers = {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json'\n    };\n\n    if (this.loggedIn()) {\n      headers['Authorization'] = 'Bearer ' + this.getToken();\n    }\n\n    return fetch(url, _objectSpread({\n      headers\n    }, options)).then(this._checkStatus).then(response => response.json());\n  }\n\n}","map":{"version":3,"sources":["/Users/babatundeolajide/Projects/ExpressGrub/AdminClient/src/services/AuthService.js"],"names":["routeConstants","AuthService","constructor","fetch","bind","login","getProfile","email","password","response","ADMIN_LOGIN","method","body","JSON","stringify","success","setProfile","res","Promise","resolve","loginAdmin","domain","then","setToken","loggedIn","token","getToken","profile","localStorage","setItem","getItem","parse","tokenResponse","accessToken","logout","removeItem","_checkStatus","status","error","Error","statusText","url","options","headers","json"],"mappings":"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","sourcesContent":["import {routeConstants } from \"../constants\";\nexport default class AuthService {\n    constructor() {\n        this.fetch = this.fetch.bind(this)\n        this.login = this.login.bind(this)\n        this.getProfile = this.getProfile.bind(this)\n    }\n\n    async login(email, password) {\n        // Get a token\n        const response =  this.fetch(routeConstants.ADMIN_LOGIN, {\n            method: 'POST',\n            body: JSON.stringify({\n                email,\n                password\n            })\n        })\n        if(response.success){\n            this.setProfile(res)\n        }\n        else{\n\n        }\n\n        return Promise.resolve(response)\n        \n    }\n\n    loginAdmin(email, password) {\n        // Get a token\n        return this.fetch(`${this.domain}/api/token`, {\n            method: 'POST',\n            body: JSON.stringify({\n                email,\n                password\n            })\n        }).then(res => {\n            this.setToken(res)\n            return this.fetch(`${this.domain}/api/user`, {\n                method: 'GET'\n            })\n        }).then(res => {\n            this.setProfile(res)\n            return Promise.resolve(res)\n        })\n    }\n\n    loggedIn() {\n        // Checks if there is a saved token and it's still valid\n        const token = this.getToken()\n        // return !!token && !isTokenExpired(token) // handwaiving here\n        return !!token // handwaiving here\n    }\n\n    setProfile(profile) {\n        // Saves profile data to localStorage\n        localStorage.setItem('profile', JSON.stringify(profile))\n    }\n\n    getProfile() {\n        // Retrieves the profile data from localStorage\n        const profile = localStorage.getItem('profile')\n        return profile ? JSON.parse(localStorage.profile) : {}\n    }\n\n    setToken(tokenResponse) {\n        // Saves user token to localStorage\n        localStorage.setItem('id_token', tokenResponse.accessToken)\n        localStorage.setItem('token', tokenResponse.token)\n    }\n\n    getToken() {\n        // Retrieves the user token from localStorage\n        return localStorage.getItem('id_token')\n    }\n\n    logout() {\n        // Clear user token and profile data from localStorage\n        localStorage.removeItem('id_token');\n        localStorage.removeItem('profile');\n    }\n\n    _checkStatus(response) {\n        // raises an error in case response status is not a success\n        if (response.status >= 200 && response.status < 300) {\n            return response\n        } else {\n            var error = new Error(response.statusText)\n            error.response = response\n            throw error\n        }\n    }\n\n    fetch(url, options) {\n        // performs api calls sending the required authentication headers\n        const headers = {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        }\n\n        if (this.loggedIn()) {\n            headers['Authorization'] = 'Bearer ' + this.getToken()\n        }\n\n        return fetch(url, {\n                headers,\n                ...options\n            })\n            .then(this._checkStatus)\n            .then(response => response.json())\n    }\n}"]},"metadata":{},"sourceType":"module"}