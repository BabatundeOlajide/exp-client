{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport Link from \"next/link\";\nimport { userActions } from \"../actions\";\nimport { connect } from \"react-redux\";\nimport { useForm } from \"react-hook-form\";\nimport { pattern, errorMessage } from '../constants';\nimport Papa from \"papaparse\";\n\nconst UploadReportModal = ({\n  children,\n  pageProps,\n  addUserError,\n  uploadReport,\n  selectedUser,\n  lastAdded\n}) => {\n  const {\n    register,\n    handleSubmit,\n    reset,\n    errors\n  } = useForm();\n\n  const processData = (headers, body) => {\n    //console.log(headers)\n    //console.log(body)\n    const requestBody = {};\n    const mainKey = headers[0];\n    const jsonData = {};\n\n    for (let i = 1; i < headers.length; i++) {\n      let record = {};\n      let key = headers[i];\n      body.map(line => {\n        let field = line[mainKey];\n        let value = line[key];\n        field = field.replace(/\\s/g, \"_\");\n        field = field.replace(\"(\", \"\");\n        field = field.replace(\")\", \"\");\n        field = field.replace(\"%\", \"P\");\n        value = value.replace(\",\", \"\");\n        record[field] = value;\n      });\n\n      if (key == \"Total\") {\n        const weeks = headers.slice(2);\n        const weekNumbers = weeks.map(w => w.split(\" \")[1]).join(\",\");\n        const weekNames = weeks.join(\",\").replace(/\\s/g, \"_\");\n        record[\"Week_Names\"] = weekNames;\n        record[\"Week_Numbers\"] = weekNumbers;\n      } else {\n        record[\"Week_Name\"] = key.replace(\" \", \"_\");\n        record[\"Week_Number\"] = key.split(\" \")[1];\n      }\n\n      key = key.replace(\" \", \"_\");\n      jsonData[key] = record;\n    }\n\n    requestBody[\"userId\"] = selectedUser.id;\n    requestBody[\"data\"] = jsonData;\n    return requestBody;\n  };\n\n  const onSubmit = formData => {\n    const file = formData.selectedFile[0];\n    let data = null;\n    Papa.parse(file, {\n      header: true,\n      skipEmptyLines: true,\n      complete: result => {\n        if (result.errors.length != 0) throw Error(JSON.stringify(result.errors));\n        const body = processData(result.meta.fields, result.data);\n        cons;\n        uploadReport(body);\n      }\n    }); //addUser(formData);\n    // if (!addUserError){\n    //     reset()\n    // }\n  };\n\n  return __jsx(\"div\", {\n    id: \"uploadReportModal\",\n    className: \"modal\"\n  }, __jsx(\"div\", {\n    className: \"modal-content\"\n  }, __jsx(\"span\", {\n    className: \"close\",\n    \"data-type\": \"hide-modal\",\n    \"data-target\": \"uploadReportModal\"\n  }, \"\\xD7\"), selectedUser && __jsx(\"h3\", null, \"Upload a report for \", __jsx(\"span\", {\n    className: \"blue\"\n  }, selectedUser.firstName + \" \" + selectedUser.lastName)), __jsx(\"hr\", {\n    className: \"divider\"\n  }), lastAdded && !addUserError && Object.keys(errors).length == 0 && __jsx(\"div\", {\n    className: \"panel code\"\n  }, __jsx(\"h4\", {\n    className: \"success\"\n  }, \" LAST RECORD: \", lastAdded.firstName + \" \" + lastAdded.lastName)), addUserError && __jsx(\"div\", {\n    className: \"panel code error-msg\"\n  }, __jsx(\"ul\", null, __jsx(\"li\", null, \" \", error))), Object.keys(errors).length != 0 && __jsx(\"div\", {\n    className: \"panel code error-msg\"\n  }, __jsx(\"ul\", null, errors.firstName && __jsx(\"li\", null, \" \", errors.firstName.message, \" \"), errors.lastName && __jsx(\"li\", null, \" \", errors.lastName.message, \" \"), errors.email && __jsx(\"li\", null, \" \", errors.email.message), errors.phoneNumber && __jsx(\"li\", null, \" \", errors.phoneNumber.message, \" \"))), __jsx(\"form\", {\n    className: \"pure-form pure-form-stacked\",\n    onSubmit: handleSubmit(onSubmit)\n  }, __jsx(\"fieldset\", null, __jsx(\"div\", {\n    className: \"pure-control-group\"\n  }, __jsx(\"label\", {\n    htmlFor: \"selectedFile\"\n  }, \"Select file\"), __jsx(\"input\", {\n    name: \"selectedFile\",\n    required: true,\n    type: \"file\",\n    id: \"selectedFile\",\n    placeholder: \"choose report file (csv)\",\n    ref: register\n  })), __jsx(\"br\", null), __jsx(\"div\", {\n    className: \"pure-controls\"\n  }, __jsx(\"button\", {\n    type: \"submit\",\n    className: \"pure-button button-secondary\"\n  }, \"Submit\"))))));\n};\n\nconst mapStateToProps = state => ({\n  addUserError: state.users.addUserError,\n  lastAdded: state.users.lastAdded,\n  selectedUser: state.users.selectedUser\n});\n\nconst mapDispatchToProps = {\n  addUser: userActions.addUser,\n  uploadReport: userActions.uploadReport\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(UploadReportModal);","map":{"version":3,"sources":["/Users/babatundeolajide/Projects/ExpressGrub/AdminClient/src/components/uploadReportModal.js"],"names":["Link","userActions","connect","useForm","pattern","errorMessage","Papa","UploadReportModal","children","pageProps","addUserError","uploadReport","selectedUser","lastAdded","register","handleSubmit","reset","errors","processData","headers","body","requestBody","mainKey","jsonData","i","length","record","key","map","line","field","value","replace","weeks","slice","weekNumbers","w","split","join","weekNames","id","onSubmit","formData","file","selectedFile","data","parse","header","skipEmptyLines","complete","result","Error","JSON","stringify","meta","fields","cons","firstName","lastName","Object","keys","error","message","email","phoneNumber","mapStateToProps","state","users","mapDispatchToProps","addUser"],"mappings":"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","sourcesContent":["import Link from \"next/link\";\nimport { userActions } from \"../actions\";\nimport { connect } from \"react-redux\";\nimport { useForm } from \"react-hook-form\";\nimport { pattern, errorMessage } from '../constants';\nimport Papa from \"papaparse\"\n\nconst UploadReportModal = ({children, pageProps,addUserError, uploadReport,selectedUser, lastAdded}) => {\n    const {register, handleSubmit,reset, errors} = useForm();\n    \n\n    const processData = (headers, body ) => {\n        //console.log(headers)\n        //console.log(body)\n        const requestBody = {}\n\n        const mainKey = headers[0]\n        const jsonData = {} \n        for (let i = 1; i < headers.length; i++) {\n            let record = {}\n            let key = headers[i]\n            body.map(line => {\n               \n\n                let field = line[mainKey]\n                let value = line[key]\n\n                field = field.replace(/\\s/g, \"_\")\n                field = field.replace(\"(\", \"\")\n                field = field.replace(\")\", \"\")\n                field = field.replace(\"%\", \"P\")\n\n                value = value.replace(\",\", \"\")\n\n                record[field] = value\n            })\n\n            if (key == \"Total\"){\n                const weeks = headers.slice(2)\n                const weekNumbers = weeks.map(w => w.split(\" \")[1]).join(\",\")\n                const weekNames = weeks.join(\",\").replace(/\\s/g, \"_\")\n\n                record[\"Week_Names\"] = weekNames\n                record[\"Week_Numbers\"] = weekNumbers\n\n            }else {\n\n                record[\"Week_Name\"] = key.replace(\" \", \"_\")\n                record[\"Week_Number\"] = key.split(\" \")[1]\n            }\n\n            key = key.replace(\" \", \"_\")\n\n            jsonData[key] = record\n\n\n        }\n\n        requestBody[\"userId\"] = selectedUser.id\n        requestBody[\"data\"] = jsonData\n        \n        return requestBody\n    }\n\n    const onSubmit = formData => {\n        const file = formData.selectedFile[0]\n\n        let data = null;\n \n        Papa.parse(file, {\n            header:true,\n            skipEmptyLines:true,\n            \n            complete: result => {\n                if (result.errors.length != 0)\n                    throw Error(JSON.stringify(result.errors))\n                const body = processData(result.meta.fields, result.data)\n                cons\n                uploadReport(body)\n                \n            }\n        })\n        \n\n\n        \n        //addUser(formData);\n\n        \n        // if (!addUserError){\n        //     reset()\n            \n        // }\n            \n\n    }\n    return <div id=\"uploadReportModal\" className=\"modal\">\n         \n        <div className=\"modal-content\">\n            <span className=\"close\" data-type=\"hide-modal\" data-target=\"uploadReportModal\">&times;</span>\n            {selectedUser && <h3>Upload a report for <span className=\"blue\">{selectedUser.firstName + \" \" + selectedUser.lastName}</span></h3> }\n            <hr className=\"divider\"/>\n            {lastAdded && !addUserError && (Object.keys(errors).length == 0) && <div className=\"panel code\">\n            <h4 className=\"success\"> LAST RECORD: {lastAdded.firstName + \" \" + lastAdded.lastName}</h4>\n                </div>\n            }\n            { addUserError && <div className=\"panel code error-msg\">\n                  <ul>\n                    <li> {error}</li>    \n                  </ul>\n                   \n                </div>\n\n            }\n            { Object.keys(errors).length != 0 && \n                <div className=\"panel code error-msg\">\n                  <ul>\n                    \n                    {errors.firstName && <li> {errors.firstName.message} </li> }\n                    {errors.lastName && <li> {errors.lastName.message} </li> }\n    \n                    {errors.email && <li> {errors.email.message}</li> }\n                    {errors.phoneNumber && <li> {errors.phoneNumber.message} </li> }\n                    \n                  </ul>\n                   \n                </div>\n            }\n            \n            <form className=\"pure-form pure-form-stacked\" onSubmit={handleSubmit(onSubmit)}>\n              <fieldset>\n                  <div className=\"pure-control-group\">\n                      <label htmlFor=\"selectedFile\">Select file</label>\n                      <input name=\"selectedFile\" required={true} type=\"file\" id=\"selectedFile\" placeholder=\"choose report file (csv)\" ref={register} />\n                  </div>\n                  <br/>\n                  \n                  <div className=\"pure-controls\">\n                      <button type=\"submit\" className=\"pure-button button-secondary\">Submit</button>\n                  </div>\n                </fieldset>\n              </form>\n          \n            \n        </div>\n    </div>\n}\n\n\nconst mapStateToProps = state => ({\n    addUserError: state.users.addUserError,\n    lastAdded: state.users.lastAdded,\n    selectedUser: state.users.selectedUser\n  });\n\nconst mapDispatchToProps = {\n    addUser: userActions.addUser,\n    uploadReport: userActions.uploadReport\n};\n  \nexport default connect(mapStateToProps, mapDispatchToProps)(UploadReportModal) \n"]},"metadata":{},"sourceType":"module"}