{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport glob from \"glob\";\nimport path from \"path\";\nimport \"../styles/pure/pure-min.css\";\nimport \"../styles/pure/grids-responsive-min.css\";\nimport \"../styles/pure/main-grid.css\";\nimport \"../styles/pure/main.css\";\nimport \"../styles/globals.css\";\nimport AdminLayout from \"../components/layouts/adminLayout\";\nimport { Provider } from \"react-redux\";\nimport { PersistGate } from \"redux-persist/integration/react\";\nimport withReduxStore from \"../lib/with-redux-store\";\nimport App, { Container } from 'next/app';\nimport { userConstants, routeConstants } from '../constants';\nimport { userActions } from \"../actions\";\nimport fetch from \"isomorphic-unfetch\";\nimport { route } from \"next/dist/next-server/server/router\";\nimport { getPageList } from \"../utils/helpers\";\n\nfunction MyApp({\n  Component,\n  pageProps,\n  reduxStore,\n  persistor\n}) {\n  const Layout = Component.Layout || AdminLayout;\n  return __jsx(React.Fragment, null, __jsx(Provider, {\n    store: reduxStore\n  }, __jsx(PersistGate, {\n    loading: null,\n    persistor: persistor\n  }, __jsx(Layout, pageProps, __jsx(Component, pageProps)))), __jsx(\"script\", {\n    type: \"text/javascript\",\n    src: \"/js/menu.js\"\n  }), __jsx(\"script\", {\n    type: \"text/javascript\",\n    src: \"/js/ui.js\"\n  }), __jsx(\"script\", {\n    type: \"text/javascript\",\n    src: \"/js/grid.js\"\n  }));\n}\n\nMyApp.getInitialProps = async appContext => {\n  var _result$data;\n\n  let pathname = appContext.router.pathname;\n  let pages,\n      page = null;\n\n  if (!appContext.ctx.pages) {\n    const pagesDir = path.resolve(`${process.cwd()}/src/pages`);\n    pages = glob.sync(`${pagesDir}/**/*.js`);\n    appContext.ctx.pages = pages;\n  } else {\n    pages = appContext.ctx.pages;\n  }\n\n  pages = pages.map(p => p.replace(pagesDir, '').replace('.js', ''));\n  pages = pages.filter(p => p !== '/_app'); // add root directory\n\n  pages.unshift('/');\n  const response = await fetch(routeConstants.REFRESH_TOKEN, {\n    method: \"POST\",\n    credentials: 'include'\n  }, []);\n  const result = await response.json();\n  let accessToken = (_result$data = result.data) === null || _result$data === void 0 ? void 0 : _result$data.accessToken;\n  appContext.ctx.reduxStore.dispatch(userActions.defaultUser(\"babatunde\", \"obabs78@gmail.com\"));\n  const appProps = await App.getInitialProps(appContext);\n  appContext.ctx.pages = pages;\n\n  if (!pages.includes(pathname) || pathname === '/404') {\n    // check to prevent- too many redirects error on the browser\n    if (pathname !== '/404') {\n      appContext.ctx.res.writeHead(302, {\n        Location: \"/404\"\n      });\n      appContext.ctx.res.end();\n    }\n  } else if (accessToken && accessToken !== \"\") {\n    appContext.ctx.reduxStore.dispatch(userActions.setAccessToken(accessToken)); // check that we are in SSR mode (NOT static and NOT client-side)\n\n    if (true && appContext.ctx.res.writeHead) {\n      // if path is / or login and we already have accessToken then change to /home\n      if (pathname === '/login' || pathname === '/' || pathname === '/index') {\n        pathname = '/';\n      } //route to the path, when it has changed\n\n\n      const currentPath = appContext.ctx.req.path;\n\n      if (pathname !== currentPath) {\n        appContext.ctx.res.writeHead(302, {\n          Location: pathname\n        });\n        appContext.ctx.res.end();\n      }\n    }\n  } else {\n    // no accessToken, route to login, if path is not already on /login \n    if (true && appContext.ctx.res.writeHead) {\n      if (pathname !== '/login') {\n        appContext.ctx.res.writeHead(302, {\n          Location: \"/login\"\n        });\n        appContext.ctx.res.end();\n      }\n    }\n  }\n\n  return _objectSpread({}, appProps);\n};\n\nexport default withReduxStore(MyApp);","map":{"version":3,"sources":["/Users/babatundeolajide/Projects/ExpressGrub/AdminClient/src/pages/_app.js"],"names":["glob","path","AdminLayout","Provider","PersistGate","withReduxStore","App","Container","userConstants","routeConstants","userActions","fetch","route","getPageList","MyApp","Component","pageProps","reduxStore","persistor","Layout","getInitialProps","appContext","pathname","router","pages","page","ctx","pagesDir","resolve","process","cwd","sync","map","p","replace","filter","unshift","response","REFRESH_TOKEN","method","credentials","result","json","accessToken","data","dispatch","defaultUser","appProps","includes","res","writeHead","Location","end","setAccessToken","currentPath","req"],"mappings":"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","sourcesContent":["import glob from \"glob\"\nimport path from \"path\"\n\nimport \"../styles/pure/pure-min.css\"\nimport \"../styles/pure/grids-responsive-min.css\"\nimport \"../styles/pure/main-grid.css\"\nimport \"../styles/pure/main.css\"\n\nimport \"../styles/globals.css\"\n\n\n\nimport AdminLayout from \"../components/layouts/adminLayout\";\nimport { Provider } from \"react-redux\"\nimport { PersistGate } from \"redux-persist/integration/react\"\nimport withReduxStore from \"../lib/with-redux-store\";\nimport App, {Container} from 'next/app'\nimport { userConstants, routeConstants } from '../constants';\nimport { userActions } from \"../actions\"\nimport fetch from \"isomorphic-unfetch\";\nimport { route } from \"next/dist/next-server/server/router\"\nimport { getPageList } from \"../utils/helpers\"\nfunction MyApp({ Component, pageProps, reduxStore, persistor }) {\n  const Layout = Component.Layout || AdminLayout;\n  \n \n  return (\n    <>\n    <Provider store={reduxStore}>\n      <PersistGate loading={null} persistor={persistor}>\n        <Layout {...pageProps}>\n          <Component {...pageProps} />\n        </Layout>\n      </PersistGate>\n    </Provider>\n      \n      <script type=\"text/javascript\" src=\"/js/menu.js\" />\n      <script type=\"text/javascript\" src=\"/js/ui.js\" />\n      <script type=\"text/javascript\" src=\"/js/grid.js\" />\n    </>\n  )\n}\n\nMyApp.getInitialProps = async (appContext) => {\n\n    let pathname = appContext.router.pathname\n    let pages, page = null\n    if(!appContext.ctx.pages){\n      const pagesDir = path.resolve(`${process.cwd()}/src/pages`)\n      pages = glob.sync(`${pagesDir}/**/*.js`)\n      appContext.ctx.pages = pages\n    } else{\n      pages = appContext.ctx.pages\n    }\n\n    pages = pages.map(p => p.replace(pagesDir, '').replace('.js',''))\n    pages = pages.filter(p => (p !== '/_app'))\n    \n    // add root directory\n    pages.unshift('/')\n\n\n    \n    const response = await fetch(routeConstants.REFRESH_TOKEN,{\n      method:\"POST\",\n      credentials:'include'\n    },[])\n    const result = await response.json()\n    let accessToken = result.data?.accessToken;\n\n    \n\n    appContext.ctx.reduxStore.dispatch(userActions.defaultUser(\"babatunde\", \"obabs78@gmail.com\"))\n    const appProps = await App.getInitialProps(appContext);\n\n    appContext.ctx.pages = pages\n    \n    if(!pages.includes(pathname) || pathname === '/404'){\n      \n      // check to prevent- too many redirects error on the browser\n      if (pathname !== '/404') {\n        appContext.ctx.res.writeHead(302, { Location: \"/404\" });\n        appContext.ctx.res.end();\n      }\n    }\n    else if (accessToken && accessToken !== \"\"){\n      appContext.ctx.reduxStore.dispatch(userActions.setAccessToken(accessToken))\n      \n      // check that we are in SSR mode (NOT static and NOT client-side)\n      if (typeof window === \"undefined\" && appContext.ctx.res.writeHead) {\n        \n        \n        // if path is / or login and we already have accessToken then change to /home\n        if (pathname === '/login' || pathname === '/' || pathname === '/index') {\n          pathname = '/'  \n        }\n\n        //route to the path, when it has changed\n        const currentPath = appContext.ctx.req.path\n        if(pathname !== currentPath){\n          appContext.ctx.res.writeHead(302, { Location: pathname });\n          appContext.ctx.res.end();\n        }\n        \n        \n      }\n    }else { \n      // no accessToken, route to login, if path is not already on /login \n\n      if (typeof window === \"undefined\" && appContext.ctx.res.writeHead) {\n        if (pathname !== '/login') {\n            appContext.ctx.res.writeHead(302, { Location: \"/login\" });\n            appContext.ctx.res.end();\n        }\n        \n      }\n    }\n\n    return { ...appProps};\n}\n\nexport default withReduxStore(MyApp)\n"]},"metadata":{},"sourceType":"module"}